{
  "version": 1,
  "platform": "swisslifeone",
  "slug": "swisslifeone_slsis",
  "name": "SwissLifeOne - SLSIS (Tarification & Simulation) HL",
  "trace": "retain-on-failure",
  "steps": [
    { "type": "goto", "url": "https://www.swisslifeone.fr/", "label": "accueil" },
    { "type": "waitForField", "field": "login_button_home", "label": "wait-login-button" },
    { "type": "clickField", "field": "login_button_home", "label": "click-login-button" },
    { "type": "sleep", "timeout_ms": 2000, "label": "wait-sso-load" },
    { "type": "waitForField", "field": "login_username", "label": "wait-sso-form" },
    { "type": "fillField", "field": "login_username", "value": "{credentials.username}", "label": "fill-user" },
    { "type": "fillField", "field": "login_password", "value": "{credentials.password}", "label": "fill-pass" },
    { "type": "clickField", "field": "login_submit", "label": "submit" },
    { "type": "waitForNetworkIdle", "label": "wait-post-login", "timeout_ms": 30000 },
    { "type": "clickField", "field": "cookie_tout_autoriser", "label": "accept-cookies", "optional": true },
    { "type": "sleep", "timeout_ms": 1000, "label": "wait-after-cookies" },

    { "type": "goto", "url": "https://www.swisslifeone.fr/index-swisslifeOne.html#/tarification-et-simulation/slsis", "label": "goto-slsis-page" },
    { "type": "sleep", "timeout_ms": 1500, "label": "wait-slsis-load" },

    { "type": "clickField", "field": "cookie_tout_autoriser", "label": "accept-cookies-page", "optional": true },
    { "type": "sleep", "timeout_ms": 1000, "label": "wait-after-cookie" },

    { "type": "enterFrame", "selector": "iframe[name='iFrameTarificateur']", "label": "enter-slsis-iframe", "timeout_ms": 15000 },
    { "type": "sleep", "timeout_ms": 800, "label": "wait-iframe-ready" },

    { "type": "comment", "text": "=== ÉTAPE 1: NOM DU PROJET ===" },
    { "type": "waitForField", "domainField": "project.name", "label": "wait-nom-projet" },
    { "type": "scrollIntoView", "domainField": "project.name", "label": "scroll-nom-projet" },
    { "type": "fillField", "domainField": "project.name", "value": "Simulation {lead.adherent.nom} {lead.adherent.prenom}", "label": "fill-nom-projet" },
    { "type": "sleep", "timeout_ms": 300, "label": "wait-after-nom-projet" },

    { "type": "comment", "text": "=== ÉTAPE 2: DATES ASSURÉ PRINCIPAL ===" },
    { "type": "waitForField", "domainField": "subscriber.birthDate", "label": "wait-date-naissance" },
    { "type": "fillField", "domainField": "subscriber.birthDate", "value": "{lead.adherent.date_naissance}", "label": "fill-date-naissance", "method": "jquery", "triggerEvents": ["change"] },
    { "type": "waitForNetworkIdle", "label": "network-after-date-naissance", "timeout_ms": 5000 },

    { "type": "comment", "text": "=== ÉTAPE 3: COUVERTURE & IJ (ACTIVE LE FORMULAIRE) ===" },
    { "type": "waitForField", "field": "slsis_couverture_oui", "label": "wait-couverture-oui" },
    { "type": "scrollIntoView", "field": "slsis_couverture_oui", "label": "scroll-couverture" },
    { "type": "clickField", "field": "slsis_couverture_oui", "label": "click-couverture-oui" },
    { "type": "waitForNetworkIdle", "label": "network-after-couverture", "timeout_ms": 5000 },

    { "type": "waitForField", "field": "slsis_ij_non", "label": "wait-ij-non", "optional": true },
    { "type": "clickField", "field": "slsis_ij_non", "label": "click-ij-non", "optional": true },
    { "type": "waitForNetworkIdle", "label": "network-after-ij", "timeout_ms": 3000 },

    { "type": "comment", "text": "=== ÉTAPE 4: TYPE SIMULATION (CHARGE LES OPTIONS) ===" },
    { "type": "waitForField", "field": "slsis_simulation_individuelle", "label": "wait-simulation-individuelle" },
    { "type": "clickField", "field": "slsis_simulation_individuelle", "label": "click-simulation-individuelle" },
    { "type": "clickField", "field": "slsis_simulation_couple", "label": "click-simulation-couple", "skipIfNot": "conjoint.present" },
    { "type": "waitForNetworkIdle", "label": "network-after-simulation", "timeout_ms": 5000 },


    { "type": "comment", "text": "=== ÉTAPE 5: DONNÉES ASSURÉ PRINCIPAL ===" },
    { "type": "waitForField", "domainField": "subscriber.departmentCode", "label": "wait-departement" },
    { "type": "selectField", "domainField": "subscriber.departmentCode", "value": "{lead.adherent.departement}", "label": "select-departement", "method": "jquery", "triggerEvents": ["change"] },
    { "type": "selectField", "domainField": "subscriber.regime", "value": "{lead.adherent.regime}", "label": "select-regime", "method": "jquery", "triggerEvents": ["change"] },
    { "type": "selectField", "domainField": "subscriber.status", "value": "{lead.adherent.statut}", "label": "select-statut", "method": "jquery", "triggerEvents": ["change"], "postDelay_ms": 300 },
    { "type": "selectField", "domainField": "subscriber.profession", "value": "{lead.adherent.profession}", "label": "select-profession", "method": "jquery", "triggerEvents": ["change"], "skipIfNot": "adherent.profession", "optional": true },
    { "type": "waitForNetworkIdle", "label": "network-after-identite", "timeout_ms": 5000 },

    { "type": "comment", "text": "=== ÉTAPE 6: DONNÉES CONJOINT (si présent) ===" },
    { "type": "waitForField", "field": "slsis_onglet_conjoint", "label": "wait-onglet-conjoint", "skipIfNot": "conjoint.present", "optional": true },
    { "type": "clickField", "field": "slsis_onglet_conjoint", "label": "click-onglet-conjoint", "skipIfNot": "conjoint.present", "optional": true },
    { "type": "sleep", "timeout_ms": 500, "label": "wait-after-onglet-conjoint", "optional": true },
    { "type": "waitForField", "domainField": "spouse.birthDate", "label": "wait-conjoint-date-naissance", "skipIfNot": "conjoint.present", "optional": true },
    { "type": "fillField", "domainField": "spouse.birthDate", "value": "{lead.conjoint.date_naissance}", "label": "fill-conjoint-date-naissance", "method": "jquery", "triggerEvents": ["change"], "skipIfNot": "conjoint.present", "optional": true },
    { "type": "selectField", "domainField": "spouse.regime", "value": "{lead.conjoint.regime}", "label": "select-conjoint-regime", "method": "jquery", "triggerEvents": ["change"], "skipIfNot": "conjoint.present", "optional": true },
    { "type": "selectField", "domainField": "spouse.status", "value": "{lead.conjoint.statut}", "label": "select-conjoint-statut", "method": "jquery", "triggerEvents": ["change"], "skipIfNot": "conjoint.statut", "optional": true },
    { "type": "selectField", "domainField": "spouse.profession", "value": "{lead.conjoint.profession}", "label": "select-conjoint-profession", "method": "jquery", "triggerEvents": ["change"], "skipIfNot": "conjoint.profession", "optional": true },
    { "type": "waitForNetworkIdle", "label": "network-after-conjoint", "skipIfNot": "conjoint.present", "optional": true, "timeout_ms": 5000 },

    { "type": "comment", "text": "=== ÉTAPE 7: ENFANTS ===" },
    { "type": "waitForField", "domainField": "children.count", "label": "wait-nb-enfants" },
    { "type": "selectField", "domainField": "children.count", "value": "{lead.projet.nb_enfants}", "label": "select-nb-enfants", "method": "jquery", "triggerEvents": ["change"] },
    { "type": "waitForNetworkIdle", "label": "network-after-nb-enfants", "timeout_ms": 5000 },

    { "type": "comment", "text": "=== Enfant 0 ===" },
    { "type": "waitForField", "field": "slsis_enfant_0_date_naissance", "label": "wait-enfant-0-date", "skipIfNot": "enfants.0.date_naissance", "optional": true },
    { "type": "fillField", "field": "slsis_enfant_0_date_naissance", "value": "{lead.enfants.0.date_naissance}", "label": "fill-enfant-0-date", "method": "jquery", "triggerEvents": ["change"], "skipIfNot": "enfants.0.date_naissance", "optional": true },
    { "type": "selectField", "field": "slsis_enfant_0_ayant_droit", "value": "{lead.enfants.0.ayant_droit}", "label": "select-enfant-0-ayant", "method": "jquery", "triggerEvents": ["change"], "skipIfNot": "enfants.0.ayant_droit", "optional": true },

    { "type": "comment", "text": "=== Enfant 1 ===" },
    { "type": "waitForField", "field": "slsis_enfant_1_date_naissance", "label": "wait-enfant-1-date", "skipIfNot": "enfants.1.date_naissance", "optional": true },
    { "type": "fillField", "field": "slsis_enfant_1_date_naissance", "value": "{lead.enfants.1.date_naissance}", "label": "fill-enfant-1-date", "method": "jquery", "triggerEvents": ["change"], "skipIfNot": "enfants.1.date_naissance", "optional": true },
    { "type": "selectField", "field": "slsis_enfant_1_ayant_droit", "value": "{lead.enfants.1.ayant_droit}", "label": "select-enfant-1-ayant", "method": "jquery", "triggerEvents": ["change"], "skipIfNot": "enfants.1.ayant_droit", "optional": true },

    { "type": "comment", "text": "=== Enfant 2 ===" },
    { "type": "waitForField", "field": "slsis_enfant_2_date_naissance", "label": "wait-enfant-2-date", "skipIfNot": "enfants.2.date_naissance", "optional": true },
    { "type": "fillField", "field": "slsis_enfant_2_date_naissance", "value": "{lead.enfants.2.date_naissance}", "label": "fill-enfant-2-date", "method": "jquery", "triggerEvents": ["change"], "skipIfNot": "enfants.2.date_naissance", "optional": true },
    { "type": "selectField", "field": "slsis_enfant_2_ayant_droit", "value": "{lead.enfants.2.ayant_droit}", "label": "select-enfant-2-ayant", "method": "jquery", "triggerEvents": ["change"], "skipIfNot": "enfants.2.ayant_droit", "optional": true },

    { "type": "comment", "text": "=== ÉTAPE 8: SÉLECTION GAMME (MAINTENANT DISPONIBLE) ===" },
    { "type": "waitForField", "domainField": "project.plan", "label": "wait-gamme" },
    { "type": "selectField", "domainField": "project.plan", "value": "SwissLife Santé", "label": "select-gamme", "method": "jquery", "triggerEvents": ["change"] },
    { "type": "waitForNetworkIdle", "label": "network-after-gamme", "timeout_ms": 5000 },

    { "type": "waitForField", "domainField": "project.dateEffet", "label": "wait-date-effet" },
    { "type": "fillField", "domainField": "project.dateEffet", "value": "{lead.projet.date_effet}", "label": "fill-date-effet", "method": "jquery", "triggerEvents": ["change"] },
    { "type": "waitForNetworkIdle", "label": "network-after-date-effet", "timeout_ms": 5000 },

    { "type": "comment", "text": "=== ÉTAPE 9: OPTIONS (MADELIN, RÉSILIATION, REPRISE) ===" },
    { "type": "scrollIntoView", "field": "slsis_madelin", "label": "scroll-madelin" },
    { "type": "clickField", "field": "slsis_madelin", "label": "click-madelin" },
    { "type": "waitForField", "field": "slsis_resiliation_non", "label": "wait-resiliation-non", "optional": true },
    { "type": "clickField", "field": "slsis_resiliation_non", "label": "click-resiliation-non", "optional": true },
    { "type": "waitForField", "field": "slsis_reprise_non", "label": "wait-reprise-non", "optional": true },
    { "type": "clickField", "field": "slsis_reprise_non", "label": "click-reprise-non", "optional": true },

    { "type": "comment", "text": "=== ÉTAPE 10: SORTIE ===" },
    { "type": "exitFrame", "label": "exit-slsis-iframe" }
  ]
}
