{
  "version": 2,
  "meta": {
    "id": "health-insurance-domain",
    "title": "Domain Model - Assurance Santé",
    "description": "Modèle de domaine universel pour les formulaires d'assurance santé. Contient uniquement les champs effectivement utilisés dans les flows d'automatisation.",
    "lastUpdated": "2025-01-15",
    "supportedCarriers": ["alptis", "swisslifeone"]
  },
  "domains": {
    "project": {
      "name": {
        "type": "text",
        "label": "Nom du projet",
        "required": true,
        "autoGenerate": true,
        "template": "Simulation {subscriber.lastName} {subscriber.firstName}",
        "validations": {
          "minLength": 2,
          "maxLength": 120
        },
        "carriers": ["swisslifeone"]
      },
      "dateEffet": {
        "type": "date",
        "label": "Date d'effet",
        "required": true,
        "format": "DD/MM/YYYY",
        "defaultExpression": "firstOfNextMonth",
        "carriers": ["alptis", "swisslifeone"]
      },
      "plan": {
        "type": "select",
        "label": "Gamme/Produit",
        "required": true,
        "default": "SwissLife Santé",
        "disabled": true,
        "carrierSpecific": true,
        "carriers": ["swisslifeone"],
        "optionSets": {
          "swisslifeone": [
            { "value": "SwissLife Santé", "label": "SwissLife Santé" }
          ]
        }
      },
      "couverture": {
        "type": "toggle",
        "label": "Couverture individuelle",
        "required": false,
        "default": true,
        "carriers": ["swisslifeone"],
        "notes": "Active la couverture individuelle. Requis pour activer le formulaire dans l'interface SwissLife."
      },
      "ij": {
        "type": "toggle",
        "label": "Indemnités journalières",
        "required": false,
        "default": false,
        "disabled": true,
        "carriers": ["swisslifeone"],
        "notes": "Option confort hospitalier: indemnités journalières en cas d'hospitalisation. Figé à NON (non modifiable)."
      },
      "madelin": {
        "type": "toggle",
        "label": "Loi Madelin",
        "required": false,
        "default": true,
        "carriers": ["swisslifeone"],
        "notes": "Option Loi Madelin: permet la déductibilité fiscale des cotisations pour les TNS (Travailleurs Non Salariés). Champ critique pour les indépendants. Par défaut OUI.",
        "showIf": {
          "field": "subscriber.status",
          "oneOf": ["TNS", "EXPLOITANT_AGRICOLE"]
        }
      },
      "resiliation": {
        "type": "toggle",
        "label": "Résiliation de contrat",
        "required": false,
        "default": false,
        "carriers": ["swisslifeone"],
        "notes": "Indique si le client résilie un contrat existant. Impact sur les modalités de prise d'effet."
      },
      "reprise": {
        "type": "toggle",
        "label": "Reprise concurrence",
        "required": false,
        "default": false,
        "carriers": ["swisslifeone"],
        "notes": "Indique si le contrat reprend un contrat concurrent existant. Impact commercial et administratif."
      }
    },
    "subscriber": {
      "civility": {
        "type": "radio",
        "label": "Civilité",
        "required": true,
        "default": "MONSIEUR",
        "carriers": ["alptis", "swisslifeone"],
        "options": [
          { "value": "MONSIEUR", "label": "Monsieur" },
          { "value": "MADAME", "label": "Madame" }
        ]
      },
      "lastName": {
        "type": "text",
        "label": "Nom",
        "required": true,
        "carriers": ["alptis", "swisslifeone"]
      },
      "firstName": {
        "type": "text",
        "label": "Prénom",
        "required": true,
        "carriers": ["alptis", "swisslifeone"]
      },
      "birthDate": {
        "type": "date",
        "label": "Date de naissance",
        "format": "DD/MM/YYYY",
        "required": true,
        "carriers": ["alptis", "swisslifeone"]
      },
      "category": {
        "type": "select",
        "label": "Catégorie socioprofessionnelle",
        "required": true,
        "default": "PERSONNES_SANS_ACTIVITE_PROFESSIONNELLE",
        "carriers": ["alptis"],
        "options": [
          { "value": "AGRICULTEURS_EXPLOITANTS", "label": "Agriculteurs exploitants" },
          { "value": "ARTISANS", "label": "Artisans" },
          { "value": "CADRES", "label": "Cadres" },
          { "value": "CADRES_EMPLOYES_FONCTION_PUBLIQUE", "label": "Cadres et employés de la fonction publique" },
          { "value": "CHEFS_D_ENTREPRISE", "label": "Chefs d'entreprise" },
          { "value": "COMMERCANTS_ET_ASSIMILES", "label": "Commerçants et assimilés" },
          { "value": "EMPLOYES", "label": "Employés, agents de maîtrise" },
          { "value": "OUVRIERS", "label": "Ouvriers" },
          { "value": "PERSONNES_SANS_ACTIVITE_PROFESSIONNELLE", "label": "Personnes sans activité professionnelle" },
          { "value": "PROFESSIONS_LIBERALES_ET_ASSIMILES", "label": "Professions libérales et assimilés" },
          { "value": "RETRAITES", "label": "Retraités" }
        ]
      },
      "regime": {
        "type": "select",
        "label": "Régime",
        "required": true,
        "carrierSpecific": true,
        "defaultsByCarrier": {
          "alptis": "SECURITE_SOCIALE",
          "swisslifeone": "TNS"
        },
        "carriers": ["alptis", "swisslifeone"],
        "notes": "Pour Alptis: 'Régime obligatoire' (régime de sécurité sociale). Pour SwissLife: 'Régime social' (champ distinct de 'statut')",
        "optionSets": {
          "alptis": [
            { "value": "ALSACE_MOSELLE", "label": "Alsace / Moselle" },
            { "value": "AMEXA", "label": "Amexa" },
            { "value": "REGIME_SALARIES_AGRICOLES", "label": "Régime des salariés agricoles" },
            { "value": "SECURITE_SOCIALE", "label": "Sécurité sociale" },
            { "value": "SECURITE_SOCIALE_INDEPENDANTS", "label": "Sécurité sociale des indépendants" }
          ],
          "swisslifeone": [
            { "value": "SECURITE_SOCIALE", "label": "Régime Général (CPAM)" },
            { "value": "SECURITE_SOCIALE_ALSACE_MOSELLE", "label": "Régime Local (CPAM Alsace Moselle)" },
            { "value": "TNS", "label": "Régime Général pour TNS (CPAM)" },
            { "value": "AMEXA", "label": "Mutualité Sociale Agricole (MSA-Amexa)" },
            { "value": "AUTRES_REGIME_SPECIAUX", "label": "Autres régimes spéciaux" }
          ]
        }
      },
      "postalCode": {
        "type": "number",
        "label": "Code postal",
        "required": true,
        "carriers": ["alptis"],
        "validations": {
          "min": 1000,
          "max": 99999
        }
      },
      "departmentCode": {
        "type": "number",
        "label": "Département",
        "required": true,
        "carriers": ["swisslifeone"],
        "validations": {
          "min": 1,
          "max": 999
        }
      },
      "status": {
        "type": "select",
        "label": "Statut",
        "required": true,
        "default": "TNS",
        "carriers": ["swisslifeone"],
        "notes": "Champ distinct de 'regime' dans SwissLife. Même liste d'options mais deux champs HTML séparés (#regime-social-assure-principal vs #statut-assure-principal)",
        "options": [
          { "value": "SALARIE", "label": "Salarié et autres statuts" },
          { "value": "SALARIE_AGRICOLE", "label": "Salarié agricole et autres statuts" },
          { "value": "EXPLOITANT_AGRICOLE", "label": "Exploitant agricole" },
          { "value": "TNS", "label": "Travailleur Non Salarié" },
          { "value": "ETUDIANT", "label": "Etudiant" },
          { "value": "RETRAITE", "label": "Retraité" },
          { "value": "RETRAITE_ANCIEN_SALARIE", "label": "Retraité (ancien salarié)" },
          { "value": "RETRAITE_ANCIEN_EXPLOITANT", "label": "Retraité (ancien exploitant)" },
          { "value": "TRAVAILLEUR_TRANSFRONTALIER", "label": "Travailleur transfrontalier" },
          { "value": "FONCTIONNAIRE", "label": "Fonctionnaire" }
        ]
      },
      "profession": {
        "type": "select",
        "label": "Profession",
        "required": false,
        "default": "AUTRE",
        "carriers": ["swisslifeone"],
        "notes": "Options chargées dynamiquement par SwissLife selon le statut sélectionné. Professions médicales bénéficient d'une réduction tarifaire de 10%.",
        "dependsOn": ["status"],
        "options": [
          { "value": "MEDECIN", "label": "Médecin" },
          { "value": "CHIRURGIEN", "label": "Chirurgien" },
          { "value": "CHIRURGIEN_DENTISTE", "label": "Chirurgien dentiste" },
          { "value": "PHARMACIEN", "label": "Pharmacien" },
          { "value": "AUXILIAIRE_MEDICAL", "label": "Auxiliaire médical" },
          { "value": "AUTRE", "label": "Non médicale" }
        ]
      },
      "workFramework": {
        "type": "radio",
        "label": "Cadre d'exercice",
        "required": false,
        "default": "SALARIE",
        "carriers": ["alptis"],
        "notes": "Détermine si le souscripteur exerce en tant que salarié ou indépendant. Ce champ apparaît uniquement pour certaines catégories socioprofessionnelles indépendantes/TNS.",
        "showIf": {
          "field": "subscriber.category",
          "oneOf": [
            "CHEFS_D_ENTREPRISE",
            "PROFESSIONS_LIBERALES_ET_ASSIMILES",
            "ARTISANS",
            "COMMERCANTS_ET_ASSIMILES",
            "AGRICULTEURS_EXPLOITANTS"
          ]
        },
        "options": [
          { "value": "SALARIE", "label": "Salarié" },
          { "value": "INDEPENDANT", "label": "Indépendant Président SASU/SAS" }
        ]
      }
    },
    "spouse": {
      "present": {
        "type": "toggle",
        "label": "Inclure le conjoint",
        "required": false,
        "default": false,
        "carriers": ["alptis", "swisslifeone"],
        "notes": "Toggle pour activer/désactiver la section conjoint. Pour Alptis, c'est un vrai toggle UI. Pour SwissLife, c'est déduit automatiquement (simulation individuelle vs couple)."
      },
      "birthDate": {
        "type": "date",
        "label": "Date de naissance du conjoint",
        "format": "DD/MM/YYYY",
        "required": true,
        "showIf": {
          "field": "conjoint",
          "equals": true
        },
        "carriers": ["alptis", "swisslifeone"]
      },
      "regime": {
        "type": "select",
        "label": "Régime",
        "required": false,
        "carrierSpecific": true,
        "defaultsByCarrier": {
          "alptis": "SECURITE_SOCIALE",
          "swisslifeone": "TNS"
        },
        "showIf": {
          "field": "conjoint",
          "equals": true
        },
        "carriers": ["alptis", "swisslifeone"],
        "notes": "Pour Alptis: 'Régime obligatoire' (régime de sécurité sociale). Pour SwissLife: 'Régime social' (champ distinct de 'statut')",
        "optionSets": {
          "alptis": [
            { "value": "ALSACE_MOSELLE", "label": "Alsace / Moselle" },
            { "value": "AMEXA", "label": "Amexa" },
            { "value": "REGIME_SALARIES_AGRICOLES", "label": "Régime des salariés agricoles" },
            { "value": "SECURITE_SOCIALE", "label": "Sécurité sociale" },
            { "value": "SECURITE_SOCIALE_INDEPENDANTS", "label": "Sécurité sociale des indépendants" }
          ],
          "swisslifeone": [
            { "value": "SECURITE_SOCIALE", "label": "Régime Général (CPAM)" },
            { "value": "SECURITE_SOCIALE_ALSACE_MOSELLE", "label": "Régime Local (CPAM Alsace Moselle)" },
            { "value": "TNS", "label": "Régime Général pour TNS (CPAM)" },
            { "value": "AMEXA", "label": "Mutualité Sociale Agricole (MSA-Amexa)" },
            { "value": "AUTRES_REGIME_SPECIAUX", "label": "Autres régimes spéciaux" }
          ]
        }
      },
      "status": {
        "type": "select",
        "label": "Statut (conjoint)",
        "required": true,
        "default": "TNS",
        "showIf": {
          "field": "conjoint",
          "equals": true
        },
        "carriers": ["swisslifeone"],
        "notes": "Champ distinct de 'regime' dans SwissLife",
        "options": [
          { "value": "SALARIE", "label": "Salarié et autres statuts" },
          { "value": "SALARIE_AGRICOLE", "label": "Salarié agricole et autres statuts" },
          { "value": "EXPLOITANT_AGRICOLE", "label": "Exploitant agricole" },
          { "value": "TNS", "label": "Travailleur Non Salarié" },
          { "value": "ETUDIANT", "label": "Etudiant" },
          { "value": "RETRAITE", "label": "Retraité" },
          { "value": "RETRAITE_ANCIEN_SALARIE", "label": "Retraité (ancien salarié)" },
          { "value": "RETRAITE_ANCIEN_EXPLOITANT", "label": "Retraité (ancien exploitant)" },
          { "value": "TRAVAILLEUR_TRANSFRONTALIER", "label": "Travailleur transfrontalier" },
          { "value": "FONCTIONNAIRE", "label": "Fonctionnaire" }
        ]
      },
      "profession": {
        "type": "select",
        "label": "Profession (conjoint)",
        "required": false,
        "default": "AUTRE",
        "showIf": {
          "field": "conjoint",
          "equals": true
        },
        "carriers": ["swisslifeone"],
        "notes": "Options chargées dynamiquement par SwissLife selon le statut sélectionné. Professions médicales bénéficient d'une réduction tarifaire de 10%.",
        "dependsOn": ["status"],
        "options": [
          { "value": "MEDECIN", "label": "Médecin" },
          { "value": "CHIRURGIEN", "label": "Chirurgien" },
          { "value": "CHIRURGIEN_DENTISTE", "label": "Chirurgien dentiste" },
          { "value": "PHARMACIEN", "label": "Pharmacien" },
          { "value": "AUXILIAIRE_MEDICAL", "label": "Auxiliaire médical" },
          { "value": "AUTRE", "label": "Non médicale" }
        ]
      },
      "category": {
        "type": "select",
        "label": "Catégorie socioprofessionnelle (conjoint)",
        "required": false,
        "default": "PERSONNES_SANS_ACTIVITE_PROFESSIONNELLE",
        "showIf": {
          "field": "conjoint",
          "equals": true
        },
        "carriers": ["alptis"],
        "notes": "Catégorie socioprofessionnelle du conjoint. Utilise les mêmes valeurs que subscriber.category.",
        "options": [
          { "value": "AGRICULTEURS_EXPLOITANTS", "label": "Agriculteurs exploitants" },
          { "value": "ARTISANS", "label": "Artisans" },
          { "value": "CADRES", "label": "Cadres" },
          { "value": "CADRES_EMPLOYES_FONCTION_PUBLIQUE", "label": "Cadres et employés de la fonction publique" },
          { "value": "CHEFS_D_ENTREPRISE", "label": "Chefs d'entreprise" },
          { "value": "COMMERCANTS_ET_ASSIMILES", "label": "Commerçants et assimilés" },
          { "value": "EMPLOYES", "label": "Employés, agents de maîtrise" },
          { "value": "OUVRIERS", "label": "Ouvriers" },
          { "value": "PERSONNES_SANS_ACTIVITE_PROFESSIONNELLE", "label": "Personnes sans activité professionnelle" },
          { "value": "PROFESSIONS_LIBERALES_ET_ASSIMILES", "label": "Professions libérales et assimilés" },
          { "value": "RETRAITES", "label": "Retraités" }
        ]
      },
      "workFramework": {
        "type": "radio",
        "label": "Cadre d'exercice (conjoint)",
        "required": false,
        "default": "SALARIE",
        "carriers": ["alptis"],
        "notes": "Détermine si le conjoint exerce en tant que salarié ou indépendant. Visible uniquement pour certaines catégories socioprofessionnelles.",
        "showIf": {
          "field": "spouse.category",
          "oneOf": [
            "CHEFS_D_ENTREPRISE",
            "PROFESSIONS_LIBERALES_ET_ASSIMILES",
            "ARTISANS",
            "COMMERCANTS_ET_ASSIMILES",
            "AGRICULTEURS_EXPLOITANTS"
          ]
        },
        "options": [
          { "value": "SALARIE", "label": "Salarié" },
          { "value": "INDEPENDANT", "label": "Indépendant Président SASU/SAS" }
        ]
      }
    },
    "children": {
      "present": {
        "type": "toggle",
        "label": "Inclure des enfants",
        "required": false,
        "default": false,
        "carriers": ["alptis", "swisslifeone"],
        "notes": "Toggle pour activer/désactiver la section enfants. Pour Alptis, c'est un vrai toggle UI avec un bouton pour ajouter dynamiquement des enfants. Pour SwissLife, c'est déduit du champ 'count'."
      },
      "count": {
        "type": "number",
        "label": "Nombre d'enfants",
        "required": false,
        "min": 0,
        "max": 10,
        "carriers": ["swisslifeone"]
      },
      "[]": {
        "birthDate": {
          "type": "date",
          "label": "Date de naissance",
          "format": "DD/MM/YYYY",
          "required": false,
          "repeat": {
            "countField": "nb_enfants"
          },
          "showIf": {
            "field": "enfants",
            "equals": true
          },
          "carriers": ["alptis", "swisslifeone"],
          "notes": "Pour SwissLife, utilisé avec le champ ayantDroit pour remplir les champs individuels de chaque enfant."
        },
        "regime": {
          "type": "select",
          "label": "Régime obligatoire (par enfant)",
          "required": false,
          "defaultsByCarrier": {
            "alptis": "SECURITE_SOCIALE"
          },
          "repeat": {
            "countField": "nb_enfants"
          },
          "showIf": {
            "field": "enfants",
            "equals": true
          },
          "carrierSpecific": true,
          "carriers": ["alptis"],
          "optionSets": {
            "alptis": [
              { "value": "ALSACE_MOSELLE", "label": "Alsace / Moselle" },
              { "value": "AMEXA", "label": "Amexa" },
              { "value": "REGIME_SALARIES_AGRICOLES", "label": "Régime des salariés agricoles" },
              { "value": "SECURITE_SOCIALE", "label": "Sécurité sociale" },
              { "value": "SECURITE_SOCIALE_INDEPENDANTS", "label": "Sécurité sociale des indépendants" }
            ]
          }
        },
        "ayantDroit": {
          "type": "select",
          "label": "Ayant droit",
          "required": false,
          "default": "1",
          "repeat": {
            "countField": "nb_enfants"
          },
          "showIf": {
            "field": "enfants",
            "equals": true
          },
          "carriers": ["swisslifeone"],
          "notes": "Indique le parent ayant droit pour l'enfant (souscripteur ou conjoint). Détermine le rattachement de l'enfant.",
          "options": [
            { "value": "1", "label": "Assuré principal" },
            { "value": "2", "label": "Conjoint" }
          ]
        }
      }
    }
  }
}
